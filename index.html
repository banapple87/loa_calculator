<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>아비도스 융화 재료 제작 계산기</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif; margin: 24px; line-height: 1.45; }
    h1 { font-size: 20px; margin: 0 0 10px; }
    .sub { color:#555; font-size: 13px; margin-bottom: 14px; }
    label { display: block; font-size: 13px; color: #333; margin-bottom: 6px; }

    input {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      box-sizing: border-box;
      border: 1px solid #ddd;
      border-radius: 10px;
      outline: none;
    }
    input:focus{
      border-color: #2f6fff;
      box-shadow: 0 0 0 3px rgba(47,111,255,.15);
    }

    button {
      padding: 10px 14px;
      font-size: 14px;
      cursor: pointer;
      border: 1px solid #ddd;
      border-radius: 10px;
      background: #fff;
    }
    button:hover{ background:#f6f7f9; }
    button:active{ transform: translateY(1px); }

    .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-top:12px; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 14px; margin-top: 14px; width: 100%; max-width: 520px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size: 13px; white-space: pre-wrap; }
    .pill { display:inline-block; padding: 2px 8px; border:1px solid #ddd; border-radius: 999px; font-size: 12px; color:#444; }
    .num { color: #2f6fff; font-weight: 800; }

    .container { max-width: 820px; margin: 0 auto; }
    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      max-width: 520px;
    }

    @media (max-width: 640px) {
      body { margin: 16px; }
      h1 { font-size: 18px; }
      .grid { grid-template-columns: 1fr; max-width: 100%; }
      button { width: 100%; }
      .row { gap: 8px; }
      .card { max-width: 100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>아비도스 융화 재료 제작 계산기</h1>
    <div class="sub">
      <span class="pill">제작자 : 이준혁</span>
      <span class="pill">직변권 좀..</span>
    </div>

    <div class="grid">
      <div>
        <label>아비도스 목재</label>
        <input id="A" type="number" min="0" step="1" placeholder="0" />
      </div>
      <div>
        <label>튼튼한 목재</label>
        <input id="T" type="number" min="0" step="1" placeholder="0" />
      </div>
      <div>
        <label>부드러운 목재</label>
        <input id="S" type="number" min="0" step="1" placeholder="0" />
      </div>
      <div>
        <label>목재</label>
        <input id="W" type="number" min="0" step="1" placeholder="0" />
      </div>
      <div>
        <label>벌목의 가루</label>
        <input id="P" type="number" min="0" step="1" placeholder="0" />
      </div>
    </div>

    <div class="row">
      <button id="calcNormal">아비도스 융화 재료 제작 계산</button>
      <button id="calcSuperior">상급 아비도스 융화 재료 제작 계산</button>
    </div>

    <div class="card">
      <div id="result" class="mono">입력 후 버튼을 눌러 계산하세요.</div>
    </div>
  </div>

<script>
(() => {
  const clampInt = (x) => {
    if (!Number.isFinite(x) || x < 0) return 0;
    return Math.floor(x);
  };
  const ceilDiv = (a, b) => {
    if (b <= 0) throw new Error("b must be > 0");
    if (a <= 0) return 0;
    return Math.floor((a + b - 1) / b);
  };

  function readInputs() {
    const A0 = clampInt(Number(document.getElementById("A").value));
    const T0 = clampInt(Number(document.getElementById("T").value));
    const S0 = clampInt(Number(document.getElementById("S").value));
    const W0 = clampInt(Number(document.getElementById("W").value));
    const P0 = clampInt(Number(document.getElementById("P").value));
    return { A0, T0, S0, W0, P0 };
  }

  function feasibleForK(k, inputs, costs) {
    const { A0, T0, S0, W0, P0 } = inputs;

    const Areq = costs.A * k;
    const Sreq = costs.S * k;
    const Wreq = costs.W * k;

    if (S0 < Sreq) return null;

    const Adef = Math.max(0, Areq - A0);
    const a10Needed = ceilDiv(Adef, 10);
    const powderNeeded = a10Needed * 100;

    const maxXs = Math.floor((S0 - Sreq) / 50);

    let best = null;

    for (let xs = 0; xs <= maxXs; xs++) {
      const SafterCraftAndXs = S0 - Sreq - 50 * xs;

      const powderFromXs = 80 * xs;
      const powderAvailableWithoutW = P0 + powderFromXs;

      const powderShort = Math.max(0, powderNeeded - powderAvailableWithoutW);
      const xw = ceilDiv(powderShort, 80);

      const totalWNeed = Wreq + 100 * xw;

      const swMax = Math.floor(SafterCraftAndXs / 25);
      const tMax = Math.floor(T0 / 5);

      const Wshort = Math.max(0, totalWNeed - W0);
      const n = ceilDiv(Wshort, 50);

      let sw = Math.min(swMax, n);
      let tToW = n - sw;

      if (tToW > tMax) continue;

      const score = xs + xw + sw + tToW + a10Needed;
      const plan = { k, xs, xw, sw, tToW, a10Needed };

      if (!best || score < best.score) best = { plan, score };
    }

    return best ? best.plan : null;
  }

  function computeMax(inputs, costs) {
    let lo = 0;
    let hi = 1;

    while (true) {
      const f = feasibleForK(hi, inputs, costs);
      if (!f) break;
      hi *= 2;
      if (hi > 10_000_000) break;
    }

    while (lo + 1 < hi) {
      const mid = Math.floor((lo + hi) / 2);
      const f = feasibleForK(mid, inputs, costs);
      if (f) lo = mid;
      else hi = mid;
    }

    const bestPlan = feasibleForK(lo, inputs, costs);
    return { k: lo, plan: bestPlan };
  }

  function simulate(plan, inputs, costs) {
    const { A0, T0, S0, W0, P0 } = inputs;
    let A = A0, T = T0, S = S0, W = W0, P = P0;

    S -= plan.xs * 50;
    P += plan.xs * 80;

    S -= plan.sw * 25;
    W += plan.sw * 50;

    T -= plan.tToW * 5;
    W += plan.tToW * 50;

    W -= plan.xw * 100;
    P += plan.xw * 80;

    P -= plan.a10Needed * 100;
    A += plan.a10Needed * 10;

    A -= costs.A * plan.k;
    S -= costs.S * plan.k;
    W -= costs.W * plan.k;

    return { A, T, S, W, P };
  }

  const result = document.getElementById("result");

  function run(mode) {
    const inputs = readInputs();

    const costs = (mode === "normal")
      ? { A: 33, S: 45, W: 86, name: "일반 아비도스 융화 재료" }
      : { A: 43, S: 59, W: 112, name: "상급 아비도스 융화 재료" };

    const out = computeMax(inputs, costs);

    if (!out.plan || out.k <= 0) {
      result.innerHTML =
`[${costs.name}] 최대 제작 결과
- 최대 제작: 0개

입력 값으로는 1회 제작도 불가능합니다.
필요: 아비도스 목재(원목) ${costs.A}개, 부드러운 목재 ${costs.S}개, 목재(원목) ${costs.W}개`;
      return;
    }

    const craftedItems = out.k * 10;
    const after = simulate(out.plan, inputs, costs);

    result.innerHTML =
`[${costs.name}] 최대 제작 결과
- 최대 제작: ${craftedItems}개  (10개 제작 <span class="num">${out.k}</span>회)

[사용한 교환]
- 부드러운 목재 25개 -> 목재 50개 : <span class="num">${out.plan.sw}</span>회
- 튼튼한 목재 5개 -> 목재 50개 : <span class="num">${out.plan.tToW}</span>회

- 목재 100개 -> 벌목의 가루 80개 : <span class="num">${out.plan.xw}</span>회
- 부드러운 목재 50개 -> 벌목의 가루 80개 : <span class="num">${out.plan.xs}</span>회

- 벌목의 가루 100개 -> 아비도스 목재 10개 : <span class="num">${out.plan.a10Needed}</span>회

[최종 잔량]
- 아비도스 목재 : ${after.A}개
- 튼튼한 목재 : ${after.T}개
- 부드러운 목재 : ${after.S}개
- 목재 : ${after.W}개
- 벌목의 가루 : ${after.P}개`;
  }

  document.getElementById("calcNormal").addEventListener("click", () => run("normal"));
  document.getElementById("calcSuperior").addEventListener("click", () => run("superior"));
})();
</script>
</body>
</html>
